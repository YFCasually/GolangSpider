# 再见，Python！你好，Go语言 #

Go 语言诞生于谷歌，由计算机领域的三位宗师级大牛 Rob Pike、Ken Thompson 和 Robert Griesemer 写成。由于出身名门，Go 在诞生之初就吸引了大批开发者的关注。诞生十年以来，已经涌出了很多基于 Go 的应用。就在不多久之前，知乎也舍弃了 Python，转 用Go 重构推荐系统 。

> 
> 
> 
> 作者：华为云技术宅基地 链接：https://zhuanlan.zhihu.com/p/57895717
> 
> 

谷歌前员工 Jake Wilson 认为，比起大家熟悉的 Python，Go 语言其实有很多优良特性，很多时候都可以代替 Python，他已经在很多任务中使用 Go 语言替代了 Python。那么 Go 语言到底有着什么样的独特魅力？它有哪些胜于 Python 的地方呢？让我们一起来了解一下吧！

### **2019 年程序员最想学习的编程语言** ###

![image](https://user-gold-cdn.xitu.io/2019/3/11/1696a569e4e69e1f?imageView2/0/w/1280/h/960/ignore-error/1)

**出身名门的 Go 语言**

对于一门只有十年历史的新语言，Go 的发展势头相当迅猛，容器界的扛把子 Docker 就是用 Go 写的，国内也有不少团队广泛使用 Go。近日，HackerRank 在社区发起了程序员技能调查，来自 100 多个国家、超过 70000 名开发者参与其中。调查结果显示，2019 年，程序员最想学习的编程语言 Top 3 分别是 Go、Kotlin 和 Python，其中 Go 以 37.2% 的比例排在首位。

![image](https://user-gold-cdn.xitu.io/2019/3/11/1696a569e4e44f5f?imageView2/0/w/1280/h/960/ignore-error/1)

但 Go 要想撼动编程界的常青树 Java 二十多年的地位无疑难度颇大。据 HackerRank 数据显示，2018 年，Java 在开发者最受欢迎的编程语言排行榜中仍然排名第 2，Python 排名第 4，Go 排名第 13，距离第一名 JavaScript 还有不小的差距。

但对本文作者 Jack Wilson 来说，Go 语言虽然“年纪尚小”，但已经拥有很多非常优秀的特性。

### Go 语言到底好在哪？ ###

在很多任务上，我已经用 Go 语言代替了 Python，举几个例子：

* 处理储存在 S3 上的云端日志
* 在 S3 上的 bucket 和 / 或 region 之间移动 TB 级别大小的文件
* 匹配本地的数据库记录和 S3 上的文件，以保证文件处于同步状态

这些任务大多是一次性的，所以使用脚本语言操作就会比较合适。这些任务需要快速地编程，而代码用过一次一般就舍弃了。一般来说，这种任务的需求都比较新颖、比较专，其代码很少需要复用。下面就来介绍一下，针对这种任务为什么可以用 Go 语言来替代 Python。

##### **拥有编译器很方便** #####

我经常在写 Python 时犯很低级的错误。我会给变量或函数命错名，或向它们传递错误的参数。这样的错误用调试工具可以找出一部分，但这种工具一般需要专门设置。我从来没很方便地配置过 pylint，而且我也不喜欢用那些很重的、配置起来更麻烦的 IDE。最惨的情况是，你可能会不小心打错变量名，而这种错误又不太容易发现。你的脚本可能会跑好几个小时才遇上这个错误，然后一切都崩溃了，你又得从头开始跑这个脚本。这种错误大部分都可以靠单元测试检出，但单元测试很少能覆盖 100% 的代码，而且我并不想浪费时间去给一个只用一次的脚本写单元测试。而带编译器的语言就可以解决以上所有问题。**编译器可以检测出你犯的所有低级错误。**出于这点原因，我在写长达几百行的代码时，更倾向于使用 Go 这类语言。

##### **开发速度** #####

然而，需要编译的语言的一个缺点是，一般你的开发速度会下降。这点在 C/C++ 和 Java 等语言上体现得尤其明显。而 Go 是一个非常简单的语言，我发现它的开发速度并没有被拖慢多少。不要误会，我的意思并不是说它比 Python 还快，而是想说，**用 Go 语言没有比 Python 慢很多，一般达到使用 Python 开发速度的 85% 还是没问题的。**相对于拥有编译器能避免的那些低级错误来说，我认为牺牲 15% 的开发速度还是很值的。

##### **更好的并行性** #####

你可能已经知道， **Go 语言就是为并行而生的** 。在我的团队里经常会需要并行程序，因为我们要在 S3 上操作我们数据库中大量的数据。如果该任务是 IO 密集型的（实际上很多任务都是），我们就可以很容易地部署 Python 线程。但如果任务是 CPU 密集型的，用 Python 就比较不方便了，因为有全局解释器锁的存在。我非常享受在 Go 语言中简单代码不用修改就能直接多线程运行的爽快感。不知你在 Python 中有没有遇到过这种问题：直接复制粘贴的多线程代码却完全不工作。在 Go 语言中就不会有此问题。

##### **部署简单** #####

我比较喜欢把所有依赖放在单个二进制文件里。我经常在 EC2 服务器上运行自己的脚本，好让环境更加接近我们在 S3 上的服务器。如果用 Python 的话，我需要保证所有需要的包都在服务器上装好，而且我的同事不能在服务器上装任何可能产生冲突的包。虚拟环境可以解决大部分问题，但我还是觉得用 Go 语言更方便。我一般是在 Mac 和 Linux 上交叉编译我的代码，将其拷贝到远程服务器上，然后就可以任其运行了。我的代码所需要的所有依赖都在一个二进制文件里。

##### **风格一致** #####

一开始，Go 语言的格式化工具 gofmt 实在是让我抓狂，尤其是它在代码缩进时要求使用 tab 键而不是空格键。我觉得这简直是疯了。但是我用了一段时间后，就开始“真香”了。写代码时，我在格式上可以天马行空，格式化工具会帮我完成一切。我的所有代码风格都是一致的，即使我是在写不同的项目。这是因为 **格式化是标准 Go 工具的一个特性** 。但我如果想在 Python 中实现这一点，就要费些劲儿了。我需要正确地配置 pylint 工具，并要保证在每一个项目中都使用它。

##### **更便捷的工具** #####

Gofmt 只是 Go 语言众多工具中的一个小例子。所有我喜欢用的编辑器——VSCode，vim 和 Sublime Text 中，都有 Go 语言相应的扩展，让我能够方便地享受到 Go 工具的优点。这样，我就能获得写 Java 时的那种智能体验，却不需要真正使用一个 IDE。我在用 Python 时从未获得过这种体验。

### Go 语言当然也有缺点 ###

我每次看到批评 Go 语言的文章时，里面讲的几乎都是 Go 语言对关键特性的缺失，比如泛型。我倒是认为没有泛型没什么影响——你会发现，使用map和切片（Slice）就能实现多得惊人的操作。但是我在使用 Go 语言的过程中遇到了很多其他问题。

##### **缺乏灵活性** #####

首先， **Go 语言可能是我用过的语言里最“固执”的语言** 了。比如，它除了会强迫你使用 tab 而不是空格键缩进（假设你用了 gofmt 工具），会强迫你使用特定的文件组织结构，还会强迫你在 GOPATH 环境变量中编程，如此等等。这种语言有太多难以改变的特性了。 **Go 语言简单易学的原因之一恐怕就是你不能改变这些特性** 。如果你不愿意将所有首字母大写的变量名 export 一遍，那真是抱歉了。幸运的是，Go 的这些特性倒是没有触犯我的原则底线，但是如果有人认为里面的某些要求根本无法理喻，我也能够理解。相比之下 Python 就灵活多了。

##### **库支持有点差劲** #####

在这方面把 Go 语言和 Python 做比较有些不公平。Go 的出现比 Python 晚很多，但当我发现有些功能 Go 居然不支持的时候，还是觉得很困惑。我甚至发现 StackOverflow 上很多人 po 出了本应该作为内置功能的代码段，而且大家都需要该功能，纷纷将代码复制粘贴到自己的项目下。这类功能不应该嵌入到语言内部吗？说到这里，我想到了近几年的两个例子：

* 给切片排序（幸运的是在 Go 1.8 版本中这点方便多了）
* Math.round 只支持整数，不能进行浮点数的取整（比如你想找一个最接近 0.5 的整数，Go 语言就无法完成）。甚至在 Go 1.10 版本之前，根本没有 math.round 函数

当然，这些问题的原因有一部分是 Go 语言没有泛型，另一部分是因为 Go 的开发者们只给 Go 的标准库中添加最最必要的功能。

这两点我都理解，但是在遇到很小的问题却需要自己写代码解决时还是感到烦恼。希望随着 Go 语言的发展，它的问题会变得越来越少。

Go 和 Python 你更喜欢谁？欢迎留言交流！

##### 在接触Golang以前，我用C/C++、Lua及Python作为主要开发语言。 #####

**C/C++的问题：**

* 开发效率低，对开发者要求高
* libc只向后兼容，运维难度偏大

**Lua/Python的问题：**

* 动态语言，缺少编译过程，低级错误频出
* 缺少有效的性能分析及调试工具

** 场景**

当时刚完成了nginx WAF模块的开发工作，便开始着手搭建WAF的后台管理系统。 由于之前同事都用的fluentd作为日志收集组件，为保持基础组件的一致性，我也选择了fluentd。 即最终架构为fluentd->mongodb->mysql，再基于mysql做前端数据展示。 后来被坑了许多次，就决定用Go重写fluentd以解决下面几个问题：

* fluentd在ubuntu 9.04偶尔会出现假死，导致数据丢失
* fluentd难以接入公司现有的包发布系统，导致运维难度极大
* mongodb采用mmap实现，数据量大时占用内存过高

**方案**

* gofluent的代码 [请点击这里]( https://link.juejin.im?target=http%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fhnlq715%2Fgofluent )
* httpmq的代码 [请点击这里]( https://link.juejin.im?target=http%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Fhnlq715%2Fhttpmq )

事实上，这两个项目都是为了解决上面提到的问题。 说起来也许你不信，这两个套代码是我在业余时间完成的，也就是说这根本不算在KPI之内。 其实一开始我也没想到能够这么快就写得七七八八，毕竟是现学现用啊。 但实际情况就是，我花了一周时间写完httpmq，一个月多时间就写好了gofluent……当然，这两个项目还有很多不完善的地方。目前就日志收集方案来说，我更推荐 [elastic/logstash-forwarder · GitHub]( https://link.juejin.im?target=http%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Felastic%2Flogstash-forwarder ) 和 [elastic/logstash · GitHub]( https://link.juejin.im?target=http%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fgithub.com%2Felastic%2Flogstash ) 配合使用。

**为什么选择Golang**

那么，为什么我会选择Golang呢？其实我在做出这个选择之前已经花了大量时间做过详尽调研。 国外如Google、AWS、Cloudflare、CoreOS等，国内如七牛、阿里等都已经开始大规模使用Golang开发其云计算相关产品。 跟着世界级巨人的脚步应该不至于走错方向，而且在学习Golang的过程中，我也渐渐被其背后的设计哲学所折服。

另外，云风博客中曾说过这样一句话：

> 
> 
> 
> 我发现我花了四年时间锤炼自己用 C 语言构建系统的能力，试图找到一个规范，可以更好的编写软件。结果发现只是对 Go
> 的模仿。缺乏语言层面的支持，只能是一个拙劣的模仿。
> 
> 

以下则是我对Golang的浅薄理解：

* 有C基础，学Golang非常轻松
* 同步方式轻松实现高并发
* 代码简洁，格式统一，阅读方便
* 性能强劲的同时，开发效率又不差于Python等动态语言

**效果**

最开始准备上线的时候其实心里挺忐忑，毕竟一旦出现故障，不仅黑锅得自己背，面子也上过不去啊。 还好结果蛮漂亮，自上线后没出现过一次突发性BUG，降低运维难度的同时还减少了机器的负载。

总而言之，从工程的角度上来看，对于大多数后台应用场景，选择Golang是极为明智的选择。 这样可以很轻松的兼顾运行性能、开发效率及维护难度这三大让诸多程序猿欲仙欲死的奇点。

#### 阅读更多 ####

**资本寒冬下的android面经** ( https://link.juejin.im?target=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3OTU0MzI4MQ%3D%3D%26amp%3Bmid%3D2247487266%26amp%3Bidx%3D1%26amp%3Bsn%3D708b38a9bb62b4311925146d016861da%26amp%3Bchksm%3Deb4763bcdc30eaaac93ba154c9fb7d0e243cd77e19951eb0c752ebb093a6eafb62c5f7ca8497%26amp%3Bscene%3D21%23wechat_redirect )

**编程时，照着别人的代码敲进去有效率吗？** ( https://link.juejin.im?target=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3OTU0MzI4MQ%3D%3D%26amp%3Bmid%3D2247487249%26amp%3Bidx%3D1%26amp%3Bsn%3Db3fe28910901dd8f1b3be6ac1009ea36%26amp%3Bchksm%3Deb47638fdc30ea99a1bce16e9d8efbd993ba4a870cc403b3ca580081683d4cd89b0ad7489643%26amp%3Bscene%3D21%23wechat_redirect )

**开发了5年android，我开始了go学习之旅** ( https://link.juejin.im?target=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3OTU0MzI4MQ%3D%3D%26amp%3Bmid%3D2247486688%26amp%3Bidx%3D1%26amp%3Bsn%3De8683f8001ca746783f38bbed581e89a%26amp%3Bchksm%3Deb47607edc30e96800d79d23fcdb5a82e4fe664f035d7dd7260ad7dab5c0ff15c22559a0e35b%26amp%3Bscene%3D21%23wechat_redirect )

**2018 开发者生态报告：Java 最流行，Go 最有潜力，JavaScript最常用** ( https://link.juejin.im?target=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3OTU0MzI4MQ%3D%3D%26amp%3Bmid%3D2247485911%26amp%3Bidx%3D1%26amp%3Bsn%3D30661b52920fd598d485d25604185964%26amp%3Bchksm%3Deb476549dc30ec5f330cb07c15fb27b0436f361cd23430a19f4bbfb044ab12d7808c335637a5%26amp%3Bscene%3D21%23wechat_redirect )

最后， 我还是建议你在这个互联网时代里，不要刻意追求一种语言，每一种语言都是有他的优势，选择合适的才是最重要的。互联网没有过期的技术，也没有寒冷的冬天。我们选择尽可能多的储备粮食柴火。欢迎关注我微信技术号：终端研发部，id：codeGoogler。如果您遇到什么问题，也可以和我一块交流~