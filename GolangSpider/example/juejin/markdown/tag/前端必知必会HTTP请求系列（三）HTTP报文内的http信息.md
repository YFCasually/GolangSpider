# 前端必知必会HTTP请求系列（三）HTTP报文内的http信息 #

## http报文 ##

用于HTTP协议交互的信息被称为HTTP报文。请求端的http报文叫做请求报文，响应端的叫做响应报文，HTTP报文本身有多行数据构成的字符串文本。

http报文大致可分为报文首部和报文主体两块，报文主体两块。两者由最初出租。出现的空行来划分，通常并不一定要有报文主体。

## 请求报文及响应报文的结构 ##

我们来看一下请求报文和响应报文的结构。 请求报文和响应报文的首部内容由以下数据组成。现在出现的各种首部字段及状态码稍后会阐述。

> 
> 
> 
> 新浪微博请求示例
> 
> 

![请求头](https://user-gold-cdn.xitu.io/2019/5/29/16b041f15a561801?imageView2/0/w/1280/h/960/ignore-error/1) ![响应头](https://user-gold-cdn.xitu.io/2019/5/29/16b041ecd4e1cdb1?imageView2/0/w/1280/h/960/ignore-error/1)

### 请求行 ###

包含用于请求方法，请求URL和HTTP请求

### 状态行 ###

包含表明响应结果的状态码，原因短语和HTTP版本

### 首部字段 ###

包含表示，请求和响应的各种条件和属性的各类首部
一般有四种首部分别是通用首部，请求首部，响应首部，实体守护

### 其他 ###

能包含HTTP的RFC，里面未定义的首部

## 编码提升传输效率 ##

HTTP在传输数据时可以按照数据原貌直接传输，但也可以。在传输过程，通过编码提升传输效率。通过在传输是编码，能有效地处理大量的访问请求，但是编码的操作需要计算机来完成，因此会消耗更多的CPU资源

### 报文主体和实体主体的差异 ###

* 报文
是HTTP通信中的基本单位，是由八位组节流。组成通过HTTP通信传输
* 实体
作为请求或响应的有效载荷，数据被传输，其内容有实体守护和出题主体组成
HTTP的主体用于传输请求或响应的实体主体。
通常报文主体等于实体主体。只有当天传输中进行编码操作时，实体主体的内容发生变化，才导致他和报文主体产生差异
报文和实体这两个术语在之后会经常出现，请事先理解两者的差异

### 压缩传输的内容编码 ###

像待发送邮件内增加附件时，为了使邮件容量变小，我们会先用zip压缩文件之后再添加附件发送
HTTP协议中有一种被称为内容编码的功能，也能进行类似的操作，内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩，内容编码后的实体由客户端接收并负责解码

![](https://user-gold-cdn.xitu.io/2019/5/29/16b042b103845d05?imageView2/0/w/1280/h/960/ignore-error/1)

常用的内容编码有以下几种

* gzip
* comperss(UNIX 系统的标准压缩)
* deflate(zlib)
* identity(不进行编码)

### 分割发送的分块传输编码 ###

在HTTP通信过程中，请求的编码实体资源尚未全部传输完成，之前浏览器无法显示请求页面，在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面
这种把实体分块的功能称之为分块传输编码

![](https://user-gold-cdn.xitu.io/2019/5/29/16b042c4a262f29a?imageView2/0/w/1280/h/960/ignore-error/1) 分块传输编码会将实体主体分成多个部分，每一块都会用16进制来标记块大小，而实体主体最后一块会使用“0(CR+LF)”来标记
使用分块传输编码的实体主题，会有接收的客户端，负责解码，恢复到编码前的实体主体
HTTP1.1中存在一种称为传输编码(transfer coding)的机制，他可以在通信时按某种编码方式传输，但指定一多用于分块传输编码中

### 发送多种数据的多部分对象集合 ###

发送邮件时，我们可以在邮件里写入文字并添加多份附件。这是因为采用了MIME(Multipurpose Internet Mail Extensions, 多用途因特网邮件扩展)机制。它允许邮件处理文本，图片，视频等多个不同类型的数据。例如，图片等二进制数据以ASCII码字符串编码的方式指明，就是利用MIME来描述标记数据类型。而在MIME扩展中会使用一种称为多部分对象集合（Multipart）的方法，来容纳多份不同类型的数据。
相应的HTTP协议中也采纳了多部分对象集合，发送的一份报文主体可含有多类型实体。通常是在图片或文本文件等上传时使用。
多部分对象集合包含的对象如下。

* multipart/form-data
在web表单上传时使用。
* multipart/byteranges
状态码206响应报文包含了多个范围的内容使用。
在HTTP报文中使用多部分对象集合时需要在首部字段里面加Content-type。有关这舍不得知道，我们稍后讲解
使用boundary字符串来划分多部分对象集合指令的各类实体，在boundary字符串指定的各个实体的起始行之前插入“--”标记（例如：--AaB03x、--THIS_STRING_SEPARATES）而在多部分对象集合对应的字符串的最后，插入“--”标记作为结束
多部分对象集合的每个部分类型中都可以含有首部字段，另外可以在某个部分中嵌套，使用多部分对象汽车。

## 获取部分内容的范围请求 ##

以前，用户不能使用现在这种高速的带宽访问互联网，当时，下载一个尺寸稍微大的图片或者文件就已经很吃力了。如果下载过程中遇到网络中断的情况。那就必须重头开始，为了解决上面的这个问题，需要一种可恢复的机制，所谓恢复是指能从之前下载中断处恢复下载。
实现该功能需要指定下载实体的范围。像这样，指定范围发送的请求叫做范围请求(Range Request)。
对一份10000字节大小的资源，如果使用范围请求，可以之请求5001~10000字节的资源。
执行范围请求时，会用到首部字段Rang 来指定资源的byte范围。byte范围的指定形式如下：

* 5001-10000字节

` Range: bytes=5001-10000 复制代码`

* 从5001字节之后全部的

` Range: bytes=5001- 复制代码`

* 从一个开始到3000字节和5000~7000字节的多重范围

` Range: bytes=0-3000, 5000-700 复制代码`

针对范围请求，响应会返回状态码为206 Partial Content 的响应报文。另外，对于多重范围的范围请求，响应会在首部字段Content-Type标明multipart/byteranges后返回响应的报文。
如果服务器无法响应范围请求，则会返回状态码200 ok 和完整的实体内容。

## 内容协商返回最合适的内容 ##

同一个web网站有可能存在着多份相同内容的页面。比如英语版和中文版的web页面，他们内容虽然相同，但使用的语言却不同。
当浏览器的默认语言为英语或者是中文的时候，访问相同的RUI的web页面时，则会显示对应的英语版或中文版的web页面。这样的机制称为内容协商。
内容协商机制是指客户端和服务端就响应的资源进行交涉，然后提供给客户端最为适合的资源。内容协商会以语言、字符集、编码方式等为基准判断响应的资源。
包含在请求报文中的某些首部字段就是判断的基准。这些首部字段的详细说明请参考下一部分的内容

* Accept
* Accept-Charset
* Accept-Encoding
* Accept-Language
* Content-Language

内容协商技术有以下三种类型。
**服务器协商(Server-driven Negotiation)**
由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自动处理。但对用户来说，以浏览器发送的信息作为判定的依据，并不一定能筛选出最优的内容。
**客户端驱动协商(Agent-driven Negotiation)**
有客户端进行内容协商的方式。用户从浏览器现实的可选项列表中手动选择。开可以利用JavaScript脚本在web页面上自动进行上述选择。比如按OS得类型或浏览器的类型，自行切换成PC版页面或手机版页面。
**透明协商(Transparent Negotiation)**
是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进行内容协商的一种方法。

本文作者前端技术小哥,转载请声明

新前端技术交流群召集前端技术人，这里有Node.js/Vue.js/React.js/React-Native.js/微信小程序 技术问题交流。欢迎加入！群号：426334209

点击链接加入群聊【前端技术交流群】 [qm.qq.com/cgi-bin/qm/…]( https://link.juejin.im?target=http%3A%2F%2Fqm.qq.com%2Fcgi-bin%2Fqm%2Fqr%3Fk%3DUQXIbf1ddoZwSZkq2WFhaC7vI5ESEFub%26amp%3BauthKey%3DGSLtrpjTZUp%252BqBxn1CX0YGMtxWPaveBFYQjQNI8COlgzU4%252Fmk8lpTJc6Rc1YBCyA%26amp%3Bgroup_code%3D426334209 )